<div class="learners-container" [class.dark-mode]="isDarkMode">
  <!-- Header -->
  <div class="header">
    <h2 class="title">Learners Management</h2>
    <button class="btn btn-primary" (click)="openModal('add')">
      <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
      </svg>
      Add Learner
    </button>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    <div class="error-icon">⚠️</div>
    <div class="error-text">
      <h3>Error</h3>
      <p>{{error}}</p>
      <button class="retry-btn" (click)="loadLearners()">Try Again</button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading learners...</p>
  </div>

  <!-- Filters -->
  <div class="filters-section" *ngIf="!loading && !error">
    <div class="filters-grid">
      <!-- Search -->
      <div class="filter-group">
        <label>Search by Name</label>
        <input type="text" [(ngModel)]="filters.search" (ngModelChange)="applyFilters()" 
               placeholder="Enter learner name..." class="input">
      </div>

      <!-- Role Filter -->
      <div class="filter-group">
        <label>Role</label>
        <select [(ngModel)]="filters.role" (ngModelChange)="applyFilters()" class="select">
          <option value="">All</option>
          <option value="adult">Adult</option>
          <option value="child">Child</option>
        </select>
      </div>

      <!-- Gender Filter -->
      <div class="filter-group">
        <label>Gender</label>
        <select [(ngModel)]="filters.gender" (ngModelChange)="applyFilters()" class="select">
          <option value="">All</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
      </div>

      <!-- Age Range -->
      <div class="filter-group">
        <label>Age Range</label>
        <div class="age-range">
          <input type="number" [(ngModel)]="filters.ageMin" (ngModelChange)="applyFilters()" 
                 placeholder="Min" class="input age-input">
          <span>to</span>
          <input type="number" [(ngModel)]="filters.ageMax" (ngModelChange)="applyFilters()" 
                 placeholder="Max" class="input age-input">
        </div>
      </div>

      <!-- Last Active Filter -->
      <div class="filter-group">
        <label>Last Active</label>
        <select [(ngModel)]="filters.lastActive" (ngModelChange)="applyFilters()" class="select">
          <option value="">All</option>
          <option value="today">Today</option>
          <option value="week">This Week</option>
          <option value="month">This Month</option>
          <option value="inactive">Inactive (>30 days)</option>
        </select>
      </div>
    </div>

    <!-- Clear Filters -->
    <button class="btn btn-secondary" (click)="clearFilters()">Clear Filters</button>
  </div>

  <!-- Results Summary -->
  <div class="results-summary" *ngIf="!loading && !error">
    Showing {{((currentPage - 1) * itemsPerPage) + 1}} to {{Math.min(currentPage * itemsPerPage, filteredLearners.length)}} of {{filteredLearners.length}} learners (Page {{currentPage}} of {{totalPages}})
  </div>

  <!-- Learners Table -->
  <div class="table-container" *ngIf="!loading && !error && filteredLearners.length > 0">
    <table class="learners-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Username</th>
          <th>Email</th>
          <th>Role</th>
          <th>Gender</th>
          <th>Age</th>
          <th>Nationality</th>
          <th>Last Active</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let learner of paginatedLearners; trackBy: trackByLearner" 
            [class.inactive]="isInactive(learner.lastActiveDate)">
          <td class="name-cell">
            <div class="name-avatar">
              <div class="avatar">{{learner.name.charAt(0).toUpperCase()}}</div>
              <span>{{learner.name}}</span>
            </div>
          </td>
          <td>{{learner.username}}</td>
          <td>{{learner.email}}</td>
          <td>
            <span class="role-badge" [class]="'role-' + learner.role">
              {{learner.role | titlecase}}
            </span>
          </td>
          <td>{{learner.gender | titlecase}}</td>
          <td>{{learner.age}} years</td>
          <td>{{learner.nationality | titlecase}}</td>
          <td>
            <span class="last-active" [class]="getLastActiveClass(learner.lastActiveDate)">
              {{learner.lastActive}}
            </span>
          </td>
          <td class="actions-cell">
            <button class="btn-icon btn-edit" (click)="openModal('edit', learner)" title="Edit">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
            </button>
            <button class="btn-icon btn-delete" (click)="deleteLearner(learner)" title="Delete">
              <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination controls -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <div class="pagination">
        <button class="btn btn-secondary pagination-btn" 
                [disabled]="currentPage === 1" 
                (click)="previousPage()">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          Previous
        </button>
        
        <div class="page-numbers">
          <button *ngFor="let page of [].constructor(totalPages); let i = index"
                  class="page-btn"
                  [class.active]="currentPage === i + 1"
                  (click)="goToPage(i + 1)">
            {{i + 1}}
          </button>
        </div>
        
        <button class="btn btn-secondary pagination-btn" 
                [disabled]="currentPage === totalPages" 
                (click)="nextPage()">
          Next
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && filteredLearners.length === 0" class="empty-state">
      <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
      </svg>
      <h3>No learners found</h3>
      <p>Try adjusting your filters or add a new learner.</p>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{modalMode === 'add' ? 'Add New' : 'Edit'}} Learner</h3>
        <button class="btn-close" (click)="closeModal()">×</button>
      </div>
      
      <form [formGroup]="learnerForm" (ngSubmit)="saveLearner()" class="modal-body">
        <div class="form-grid">
          <div class="form-group">
            <label>Name *</label>
            <input type="text" formControlName="name" class="input" placeholder="Enter full name">
            <div *ngIf="learnerForm.get('name')?.invalid && learnerForm.get('name')?.touched" class="error">
              Name is required
            </div>
          </div>

          <div class="form-group">
            <label>Username *</label>
            <input type="text" formControlName="username" class="input" placeholder="Enter username">
            <div *ngIf="learnerForm.get('username')?.invalid && learnerForm.get('username')?.touched" class="error">
              Username is required
            </div>
          </div>

          <div class="form-group">
            <label>Email *</label>
            <input type="email" formControlName="email" class="input" placeholder="Enter email">
            <div *ngIf="learnerForm.get('email')?.invalid && learnerForm.get('email')?.touched" class="error">
              Valid email is required
            </div>
          </div>

          <div class="form-group">
            <label>Role *</label>
            <select formControlName="role" class="select">
              <option value="">Select role</option>
              <option value="adult">Adult</option>
              <option value="child">Child</option>
            </select>
          </div>

          <div class="form-group">
            <label>Gender *</label>
            <select formControlName="gender" class="select">
              <option value="">Select gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </div>

          <div class="form-group">
            <label>Birth Date *</label>
            <input type="date" formControlName="birthdate" class="input">
          </div>

          <div class="form-group full-width">
            <label>Nationality *</label>
            <input type="text" formControlName="nationality" class="input" placeholder="Enter nationality">
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="learnerForm.invalid">
            {{modalMode === 'add' ? 'Add' : 'Update'}} Learner
          </button>
        </div>
      </form>
    </div>
  </div>
  <app-toast></app-toast>
</div>